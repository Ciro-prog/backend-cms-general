<!-- ================================ -->
<!-- app/frontend/templates/base.html -->
<!-- ================================ -->

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}CMS Dinámico MVP{% endblock %}</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        .sidebar-active {
            background-color: #eff6ff;
            border-right: 2px solid #3b82f6;
        }
        
        .flash-message {
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0 flex items-center">
                        <i class="fas fa-cogs text-blue-600 text-2xl mr-3"></i>
                        <h1 class="text-xl font-semibold text-gray-900">CMS Dinámico MVP</h1>
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    {% if user %}
                        <span class="text-sm text-gray-700">
                            <i class="fas fa-user mr-1"></i>
                            {{ user.name or user.username }}
                        </span>
                        <span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full">
                            {{ user.role }}
                        </span>
                        <form method="post" action="/logout" class="inline">
                            <button type="submit" class="text-red-600 hover:text-red-800">
                                <i class="fas fa-sign-out-alt"></i> Salir
                            </button>
                        </form>
                    {% endif %}
                </div>
            </div>
        </div>
    </nav>

    <div class="flex h-screen bg-gray-50">
        <!-- Sidebar -->
        {% if user %}
        <div class="w-64 bg-white shadow-sm">
            <div class="flex flex-col h-full">
                <div class="flex-1 flex flex-col pt-5 pb-4 overflow-y-auto">
                    <nav class="mt-5 flex-1 px-2 space-y-1">
                        {% set current_path = request.url.path %}
                        
                        <!-- Dashboard -->
                        <a href="/dashboard" 
                           class="{% if '/dashboard' in current_path %}bg-blue-50 border-r-2 border-blue-500 text-blue-700{% else %}text-gray-600 hover:bg-gray-50 hover:text-gray-900{% endif %} group flex items-center px-2 py-2 text-sm font-medium rounded-md">
                            <i class="fas fa-tachometer-alt mr-3"></i>
                            Dashboard
                        </a>
                        
                        {% if user.role in ['super_admin', 'admin'] %}
                        <!-- Business Types -->
                        <a href="/business-types" 
                           class="{% if '/business-types' in current_path %}bg-blue-50 border-r-2 border-blue-500 text-blue-700{% else %}text-gray-600 hover:bg-gray-50 hover:text-gray-900{% endif %} group flex items-center px-2 py-2 text-sm font-medium rounded-md">
                            <i class="fas fa-shapes mr-3"></i>
                            Business Types
                        </a>
                        
                        <!-- Businesses -->
                        <a href="/businesses" 
                           class="{% if '/businesses' in current_path %}bg-blue-50 border-r-2 border-blue-500 text-blue-700{% else %}text-gray-600 hover:bg-gray-50 hover:text-gray-900{% endif %} group flex items-center px-2 py-2 text-sm font-medium rounded-md">
                            <i class="fas fa-building mr-3"></i>
                            Businesses
                        </a>
                        
                        <!-- API Configurations -->
                        <a href="/api-configs" 
                           class="{% if '/api-configs' in current_path %}bg-blue-50 border-r-2 border-blue-500 text-blue-700{% else %}text-gray-600 hover:bg-gray-50 hover:text-gray-900{% endif %} group flex items-center px-2 py-2 text-sm font-medium rounded-md">
                            <i class="fas fa-plug mr-3"></i>
                            API Configs
                        </a>
                        {% endif %}
                        
                        <!-- Dynamic Components -->
                        <a href="/components" 
                           class="{% if '/components' in current_path %}bg-blue-50 border-r-2 border-blue-500 text-blue-700{% else %}text-gray-600 hover:bg-gray-50 hover:text-gray-900{% endif %} group flex items-center px-2 py-2 text-sm font-medium rounded-md">
                            <i class="fas fa-puzzle-piece mr-3"></i>
                            Componentes
                        </a>
                        
                        {% if user.role in ['super_admin', 'admin'] %}
                        <!-- Logs -->
                        <a href="/logs" 
                           class="{% if '/logs' in current_path %}bg-blue-50 border-r-2 border-blue-500 text-blue-700{% else %}text-gray-600 hover:bg-gray-50 hover:text-gray-900{% endif %} group flex items-center px-2 py-2 text-sm font-medium rounded-md">
                            <i class="fas fa-list-alt mr-3"></i>
                            Logs
                        </a>
                        {% endif %}
                    </nav>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Main content -->
        <div class="flex-1 overflow-hidden">
            <main class="flex-1 relative overflow-y-auto focus:outline-none">
                <!-- Flash messages -->
                {% if messages %}
                    <div class="p-4">
                        {% for message in messages %}
                            <div class="flash-message mb-4 px-4 py-3 rounded {% if message.type == 'error' %}bg-red-100 border border-red-400 text-red-700{% elif message.type == 'success' %}bg-green-100 border border-green-400 text-green-700{% else %}bg-blue-100 border border-blue-400 text-blue-700{% endif %}">
                                {{ message.text }}
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}

                <!-- Page content -->
                <div class="py-6">
                    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                        {% block content %}{% endblock %}
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // Auto-hide flash messages after 5 seconds
        setTimeout(function() {
            const messages = document.querySelectorAll('.flash-message');
            messages.forEach(function(msg) {
                msg.style.opacity = '0';
                setTimeout(() => msg.remove(), 500);
            });
        }, 5000);

        // Utility functions
        window.CMS = {
            // Mostrar loading spinner
            showLoading: function(element) {
                if (typeof element === 'string') {
                    element = document.querySelector(element);
                }
                if (element) {
                    element.innerHTML = '<div class="loading-spinner"></div> Cargando...';
                }
            },

            // Hacer llamada API
            apiCall: async function(url, options = {}) {
                try {
                    const response = await fetch(url, {
                        headers: {
                            'Content-Type': 'application/json',
                            ...options.headers
                        },
                        ...options
                    });
                    return await response.json();
                } catch (error) {
                    console.error('API Error:', error);
                    return { success: false, error: error.message };
                }
            },

            // Refrescar componente
            refreshComponent: async function(componentId) {
                const element = document.getElementById(`component-${componentId}`);
                if (element) {
                    this.showLoading(element);
                    // Implementar lógica de refresh específica
                }
            }
        };
    </script>
    
    {% block scripts %}{% endblock %}
</body>
</html>